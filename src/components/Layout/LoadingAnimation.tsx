'use client';

import { useEffect, useState } from 'react';
import Image from 'next/image';

const LoadingAnimation = () => {
  const [currentValue, setCurrentValue] = useState(0);
  const [activeImageIndex, setActiveImageIndex] = useState(3); // Start with 4th image (index 3) as it has "active" class in HTML
  const [isVisible, setIsVisible] = useState(true);

  const images = [
    {
      src: "https://www.notsellingliquid.com/cdn/shop/files/flaneur-look-02-full2_0_75x_b0ae6315-d84c-4783-8401-df3d2f0739a7.jpg?v=1765366376",
      width: 3000,
      height: 1510,
      alt: ""
    },
    {
      src: "https://www.notsellingliquid.com/cdn/shop/files/Mask_group2.webp?v=1744187290",
      width: 1401,
      height: 800,
      alt: ""
    },
    {
      src: "https://www.notsellingliquid.com/cdn/shop/files/nsl-article-shopify-markets-cover.png?v=1756800540",
      width: 1000,
      height: 667,
      alt: ""
    },
    {
      src: "https://www.notsellingliquid.com/cdn/shop/files/ss23_paper_LB_10-copy_1.jpg?v=1687114691",
      width: 1500,
      height: 1285,
      alt: "Shopify Plus Agency Case - Arte Antwerp"
    },
    {
      src: "https://www.notsellingliquid.com/cdn/shop/files/FC-10Feb_4727-min.webp?v=1686924461",
      width: 1440,
      height: 961,
      alt: "Shopify Plus Agency Case - Fabienne Chapot"
    },
    {
      src: "https://www.notsellingliquid.com/cdn/shop/files/53A584C0-4882-460F-885B-0134EAB6E6BD-m.jpg?v=1758090427",
      width: 2164,
      height: 1440,
      alt: ""
    },
    {
      src: "https://www.notsellingliquid.com/cdn/shop/files/PP_SS24_Banner_1440x826_f5e0eb41-6699-49d5-b342-59250050057a.jpg?v=1714461205",
      width: 1440,
      height: 826,
      alt: ""
    },
    {
      src: "https://www.notsellingliquid.com/cdn/shop/files/Z6E6414-copy.jpg?v=1687115170",
      width: 2540,
      height: 1690,
      alt: "Shopify Plus agency Amsterdam"
    },
    {
      src: "https://www.notsellingliquid.com/cdn/shop/files/sweatsuit_banner_shopify.webp?v=1742381685",
      width: 5472,
      height: 3648,
      alt: ""
    }
  ];

  useEffect(() => {
    const targetValue = 100;
    const imageLen = images.length;
    const ratioImg = 5000 / imageLen / 2;

    // Image cycling
    const updateClass = () => {
      setActiveImageIndex(prev => (prev + 1) % imageLen);
    };

    // Start progress animation
    const progressInterval = setInterval(() => {
      if (currentValue < targetValue) {
        setCurrentValue(prev => prev + 1);
      } else {
        clearInterval(progressInterval);
        clearInterval(imageInterval);
        
        // Fade out after completion
        setTimeout(() => {
          setIsVisible(false);
        }, 1000);

        // Remove loading class from body
        setTimeout(() => {
          document.body.classList.remove('loading-nsl');
        }, 2000);
      }
    }, 20);

    // Start image cycling
    const imageInterval = setInterval(updateClass, ratioImg);

    return () => {
      clearInterval(progressInterval);
      clearInterval(imageInterval);
    };
  }, [currentValue, images.length]);

  if (!isVisible) return null;

  return (
    <div className="snippet-loading-animation fixed inset-0 z-50 bg-black flex flex-col">
      {/* Progress Bar */}
      <div className="loading-line absolute bottom-0 left-0 w-full h-1 bg-gray-800">
        <span 
          className="block h-full bg-white transition-transform duration-75 ease-linear"
          style={{
            transform: currentValue === 100 
              ? 'scaleX(0)' 
              : `scaleX(${currentValue / 100})`,
            transformOrigin: currentValue === 100 ? 'right center' : 'left center'
          }}
        />
      </div>

      {/* Logo */}
      <div className="loading-logo absolute inset-0 flex items-center justify-center">
        <svg 
          width="1400" 
          height="176" 
          viewBox="0 0 1400 176" 
          fill="none" 
          xmlns="http://www.w3.org/2000/svg"
          className="w-auto h-16 md:h-20 lg:h-24 max-w-full"
        >
          <g clipPath="url(#clip0_935_25)">
            <path
              d="M0 0H25.3254L87.86 100.653H88.2547V0H111.087V136.65H85.7616L23.3933 36.1623H22.8116V136.629H0V0Z"
              fill="white"
            />
            <path
              d="M179.002 139.323C171.066 139.323 164.002 138.018 157.811 135.407C151.599 132.795 146.364 129.19 142.063 124.589C137.784 120.009 134.522 114.517 132.278 108.135C130.034 101.752 128.912 94.7473 128.912 87.1004C128.912 79.4535 130.034 72.6147 132.278 66.2527C134.522 59.8699 137.784 54.3782 142.063 49.7983C146.343 45.1977 151.599 41.5918 157.811 38.9807C164.002 36.3695 171.087 35.064 179.002 35.064C186.918 35.064 193.982 36.3695 200.194 38.9807C206.405 41.5918 211.641 45.1977 215.941 49.7983C220.221 54.3782 223.483 59.8699 225.727 66.2527C227.97 72.6355 229.092 79.5778 229.092 87.1004C229.092 94.623 227.97 101.773 225.727 108.135C223.483 114.517 220.221 120.009 215.941 124.589C211.662 129.19 206.405 132.795 200.194 135.407C193.982 138.018 186.918 139.323 179.002 139.323ZM179.002 122.102C183.864 122.102 188.081 121.087 191.676 119.035C195.249 116.984 198.199 114.31 200.484 110.994C202.79 107.679 204.473 103.949 205.574 99.7831C206.655 95.6384 207.216 91.3901 207.216 87.0589C207.216 82.7277 206.676 78.6452 205.574 74.4177C204.494 70.2108 202.811 66.4806 200.484 63.2063C198.178 59.9528 195.228 57.3209 191.676 55.2693C188.081 53.2177 183.864 52.2022 179.002 52.2022C174.141 52.2022 169.923 53.2177 166.329 55.2693C162.735 57.3209 159.806 59.9528 157.52 63.2063C155.214 66.4806 153.511 70.1901 152.43 74.4177C151.329 78.6245 150.789 82.8314 150.789 87.0589C150.789 91.2865 151.329 95.6384 152.43 99.7831C153.511 103.928 155.194 107.679 157.52 110.994C159.827 114.31 162.756 116.984 166.329 119.035C169.923 121.087 174.141 122.102 179.002 122.102Z"
              fill="white"
            />
            <path
              d="M234.432 37.6958H250.928V8.04065H272.804V37.7165H292.562V53.9844H272.804V106.808C272.804 109.109 272.908 111.077 273.095 112.735C273.282 114.393 273.739 115.802 274.425 116.942C275.131 118.082 276.191 118.952 277.603 119.512C278.995 120.092 280.928 120.361 283.358 120.361C284.896 120.361 286.412 120.341 287.95 120.279C289.487 120.216 291.024 119.988 292.562 119.615V136.463C290.131 136.712 287.763 136.961 285.477 137.23C283.171 137.479 280.803 137.624 278.372 137.624C272.617 137.624 267.984 137.085 264.473 135.987C260.941 134.909 258.199 133.314 256.225 131.2C254.231 129.086 252.901 126.454 252.195 123.263C251.489 120.071 251.073 116.445 250.948 112.341V53.9637H234.453V37.6958H234.432Z"
              fill="white"
            />
            <path
              d="M372.382 104.881C373.026 111.264 375.436 115.74 379.674 118.268C383.891 120.817 388.961 122.102 394.84 122.102C396.876 122.102 399.203 121.936 401.841 121.626C404.459 121.315 406.931 120.714 409.237 119.802C411.544 118.911 413.413 117.605 414.888 115.885C416.343 114.165 417.028 111.906 416.904 109.088C416.779 106.29 415.761 103.99 413.829 102.208C411.918 100.426 409.445 98.9957 406.454 97.918C403.441 96.8404 400.013 95.9079 396.19 95.1411C392.347 94.3743 388.462 93.5454 384.494 92.6543C380.401 91.7632 376.474 90.6856 372.693 89.4007C368.912 88.1366 365.526 86.4166 362.534 84.2199C359.522 82.0439 357.132 79.2877 355.346 75.8891C353.538 72.5112 352.645 68.325 352.645 63.3514C352.645 57.9841 353.954 53.4871 356.571 49.8605C359.189 46.2132 362.534 43.2912 366.544 41.0738C370.574 38.8357 375.041 37.2814 379.965 36.3696C384.889 35.4785 389.605 35.0433 394.071 35.0433C399.203 35.0433 404.085 35.5821 408.739 36.6597C413.413 37.758 417.631 39.4988 421.412 41.9234C425.193 44.3481 428.309 47.498 430.823 51.394C433.316 55.29 434.875 59.9735 435.519 65.4652H412.686C411.668 60.2222 409.258 56.7407 405.498 54.9377C401.717 53.1555 397.395 52.2644 392.555 52.2644C391.017 52.2644 389.21 52.4095 387.091 52.6582C384.972 52.9276 382.998 53.3835 381.128 54.0881C379.279 54.7927 377.7 55.8081 376.433 57.1551C375.166 58.4814 374.522 60.2429 374.522 62.4189C374.522 65.0922 375.436 67.2681 377.285 68.926C379.154 70.5839 381.564 71.9516 384.577 73.0293C387.569 74.1069 390.997 75.0394 394.84 75.8062C398.684 76.573 402.631 77.4019 406.724 78.293C410.692 79.1841 414.598 80.2824 418.42 81.5466C422.264 82.8314 425.671 84.5515 428.683 86.7274C431.675 88.9034 434.127 91.6389 435.976 94.9546C437.845 98.2703 438.76 102.353 438.76 107.202C438.76 113.067 437.43 118.04 434.729 122.123C432.049 126.205 428.538 129.521 424.258 132.07C419.978 134.619 415.221 136.484 409.965 137.624C404.708 138.764 399.535 139.344 394.425 139.344C388.15 139.344 382.375 138.64 377.056 137.23C371.738 135.842 367.146 133.687 363.24 130.827C359.335 127.946 356.281 124.382 354.037 120.092C351.793 115.823 350.609 110.746 350.484 104.881H372.361H372.382Z"
              fill="white"
            />
            <path
              d="M469.674 92.8201C469.674 96.6539 470.214 100.343 471.294 103.907C472.375 107.492 474.016 110.601 476.197 113.295C478.379 115.968 481.121 118.123 484.445 119.719C487.79 121.315 491.737 122.102 496.35 122.102C502.749 122.102 507.901 120.734 511.786 117.978C515.692 115.243 518.6 111.119 520.512 105.648H541.225C540.082 111.015 538.088 115.782 535.283 120.009C532.458 124.216 529.071 127.76 525.124 130.62C521.156 133.5 516.71 135.655 511.786 137.127C506.862 138.598 501.71 139.323 496.35 139.323C488.538 139.323 481.641 138.059 475.636 135.49C469.611 132.941 464.542 129.355 460.387 124.776C456.232 120.175 453.095 114.704 450.976 108.321C448.857 101.938 447.818 94.9338 447.818 87.2662C447.818 80.2617 448.94 73.5887 451.163 67.2681C453.407 60.9475 456.606 55.4143 460.761 50.6272C464.916 45.8401 469.944 42.0478 475.823 39.2294C481.703 36.4317 488.372 35.0225 495.789 35.0225C503.58 35.0225 510.581 36.6389 516.793 39.9132C522.984 43.1668 528.136 47.4566 532.229 52.8239C536.322 58.1913 539.293 64.3461 541.142 71.3092C543.012 78.2515 543.469 85.4425 542.575 92.8408H469.674V92.8201ZM520.699 78.4587C520.449 74.9979 519.722 71.7029 518.496 68.5115C517.271 65.3201 515.609 62.5432 513.51 60.1807C511.391 57.8183 508.836 55.9117 505.844 54.4403C502.832 52.969 499.466 52.2437 495.768 52.2437C492.07 52.2437 488.434 52.9068 485.297 54.2538C482.16 55.5801 479.48 57.4452 477.236 59.8077C474.992 62.1702 473.206 64.9471 471.855 68.1385C470.526 71.3299 469.778 74.77 469.653 78.4795H520.678L520.699 78.4587Z"
              fill="white"
            />
            <path d="M556.952 0H578.829V136.65H556.952V0Z" fill="white" />
            <path d="M600.331 0H622.208V136.65H600.331V0Z" fill="white" />
            <path d="M643.69 0H665.567V20.6612H643.69V0ZM643.69 37.6959H665.567V136.629H643.69V37.6959Z" fill="white" />
            <path
              d="M686.467 37.6959H707.18V52.2437L707.575 52.6374C710.899 47.1457 715.262 42.8353 720.622 39.7268C726.003 36.5975 731.945 35.0433 738.468 35.0433C749.334 35.0433 757.914 37.8409 764.168 43.457C770.442 49.073 773.579 57.4867 773.579 68.7188V136.671H751.702V74.4799C751.432 66.7086 749.77 61.0511 746.716 57.5489C743.641 54.0259 738.842 52.2851 732.319 52.2851C728.6 52.2851 725.276 52.9483 722.346 54.2953C719.396 55.6216 716.903 57.4867 714.867 59.8492C712.81 62.2116 711.211 64.9886 710.068 68.18C708.925 71.3714 708.344 74.7493 708.344 78.3137V136.691H686.467V37.6959Z"
              fill="white"
            />
            <path
              d="M885.414 131.469C885.414 146.39 881.217 157.539 872.845 164.875C864.472 172.211 852.402 175.879 836.674 175.879C831.688 175.879 826.661 175.361 821.612 174.346C816.564 173.33 811.951 171.61 807.817 169.165C803.662 166.74 800.172 163.549 797.346 159.591C794.542 155.633 792.88 150.804 792.36 145.043H814.237C814.881 148.11 815.961 150.597 817.499 152.503C819.036 154.41 820.864 155.923 822.963 157C825.082 158.078 827.409 158.783 829.964 159.114C832.519 159.425 835.199 159.591 838.025 159.591C846.834 159.591 853.295 157.415 857.409 153.084C861.501 148.753 863.558 142.494 863.558 134.329V119.201H863.163C860.089 124.693 855.913 128.962 850.594 132.029C845.276 135.096 839.562 136.629 833.413 136.629C825.476 136.629 818.745 135.262 813.177 132.526C807.609 129.791 803.018 126.019 799.362 121.232C795.705 116.445 793.046 110.932 791.384 104.674C789.722 98.4154 788.891 91.7218 788.891 84.5722C788.891 77.9407 789.909 71.6201 791.945 65.631C794.001 59.6419 796.931 54.3782 800.774 49.8398C804.618 45.3221 809.313 41.6955 814.881 39.0222C820.449 36.3489 826.744 35.0018 833.787 35.0018C840.04 35.0018 845.795 36.3074 851.051 38.9186C856.307 41.5297 860.338 45.6537 863.143 51.249H863.537V37.6752H885.414V131.448V131.469ZM836.882 119.429C841.744 119.429 845.857 118.434 849.244 116.465C852.651 114.476 855.393 111.865 857.492 108.611C859.611 105.358 861.148 101.669 862.083 97.5036C863.039 93.3589 863.537 89.1728 863.537 84.9659C863.537 80.7591 863.018 76.6766 862 72.7184C860.982 68.7602 859.403 65.258 857.284 62.1909C855.165 59.1239 852.422 56.6992 849.036 54.917C845.65 53.1348 841.578 52.2437 836.861 52.2437C832.145 52.2437 827.907 53.2591 824.583 55.3108C821.238 57.3624 818.558 59.9942 816.522 63.2478C814.486 66.5221 813.011 70.2109 812.118 74.3556C811.224 78.5002 810.788 82.6242 810.788 86.7067C810.788 90.7892 811.287 94.7888 812.325 98.6641C813.343 102.56 814.902 106.021 817.021 109.088C819.14 112.155 821.82 114.642 825.082 116.548C828.343 118.476 832.27 119.429 836.882 119.429Z"
              fill="white"
            />
            <path d="M955.636 0H977.512V136.65H955.636V0Z" fill="white" />
            <path d="M998.994 0H1020.87V20.6612H998.994V0ZM998.994 37.6959H1020.87V136.629H998.994V37.6959Z" fill="white" />
            <path
              d="M1135.22 173.206H1113.34V123.822H1112.95C1111.16 126.496 1109.04 128.837 1106.61 130.806C1104.18 132.775 1101.5 134.412 1098.55 135.676C1095.6 136.94 1092.55 137.873 1089.35 138.453C1086.15 139.033 1082.95 139.303 1079.75 139.303C1072.46 139.303 1066.12 137.873 1060.76 134.992C1055.38 132.132 1050.93 128.299 1047.42 123.511C1043.89 118.724 1041.27 113.212 1039.55 106.953C1037.82 100.716 1036.97 94.25 1036.97 87.6185C1036.97 80.3446 1037.93 73.5059 1039.84 67.1438C1041.75 60.7817 1044.64 55.1864 1048.46 50.3993C1052.3 45.6122 1057.12 41.8613 1062.94 39.1051C1068.76 36.3696 1075.57 35.0018 1083.38 35.0018C1089.78 35.0018 1095.73 36.2452 1101.23 38.732C1106.74 41.2189 1111.02 45.3428 1114.09 51.0832H1114.49V37.6959H1135.2V173.185L1135.22 173.206ZM1058.87 87.2662C1058.87 91.5974 1059.35 95.8457 1060.3 99.9904C1061.26 104.135 1062.86 107.824 1065.1 111.077C1067.35 114.352 1070.19 116.984 1073.64 119.035C1077.11 121.087 1081.33 122.102 1086.31 122.102C1095.79 122.102 1102.77 118.869 1107.32 112.424C1111.85 105.979 1114.13 97.6072 1114.13 87.2662C1114.13 76.9252 1111.81 67.8691 1107.13 61.6314C1102.46 55.3729 1095.52 52.2437 1086.31 52.2437C1081.85 52.2437 1077.88 53.2384 1074.43 55.2071C1070.96 57.1966 1068.09 59.8077 1065.81 63.0613C1063.5 66.3149 1061.78 70.0451 1060.61 74.2727C1059.47 78.4795 1058.89 82.8107 1058.89 87.2869L1058.87 87.2662Z"
              fill="white"
            />
            <path
              d="M1243.23 136.65H1221.75V122.869H1221.36C1218.68 127.843 1214.67 131.842 1209.37 134.826C1204.05 137.831 1198.65 139.323 1193.16 139.323C1180.12 139.323 1170.68 136.111 1164.87 129.646C1159.05 123.201 1156.14 113.481 1156.14 100.467V37.6959H1178.02V98.3532C1178.02 107.016 1179.68 113.15 1183 116.735C1186.33 120.299 1191 122.102 1197.01 122.102C1201.62 122.102 1205.44 121.398 1208.52 119.988C1211.59 118.579 1214.08 116.693 1216 114.352C1217.93 111.989 1219.28 109.15 1220.11 105.834C1220.94 102.519 1221.36 98.9542 1221.36 95.1204V37.7166H1243.23V136.65Z"
              fill="white"
            />
            <path d="M1263.95 0H1285.82V20.6612H1263.95V0ZM1263.95 37.6959H1285.82V136.629H1263.95V37.6959Z" fill="white" />
            <path
              d="M1400.17 136.65H1379.46V123.263H1379.06C1376.13 129.003 1371.83 133.127 1366.2 135.614C1360.57 138.101 1354.63 139.344 1348.36 139.344C1340.54 139.344 1333.75 137.976 1327.91 135.241C1322.1 132.505 1317.26 128.754 1313.43 124.029C1309.59 119.325 1306.72 113.73 1304.81 107.285C1302.88 100.84 1301.94 93.9184 1301.94 86.5202C1301.94 77.5884 1303.15 69.8586 1305.58 63.3514C1308.01 56.8443 1311.25 51.4976 1315.28 47.2701C1319.31 43.0632 1323.9 39.9754 1329.1 37.986C1334.29 35.9965 1339.55 35.0225 1344.93 35.0225C1348 35.0225 1351.14 35.3127 1354.34 35.8722C1357.54 36.4524 1360.59 37.3643 1363.54 38.6491C1366.49 39.9132 1369.19 41.5504 1371.71 43.5191C1374.2 45.5086 1376.28 47.8296 1377.94 50.5029H1378.34V0H1400.21V136.65H1400.17ZM1323.82 88.2402C1323.82 92.4471 1324.36 96.5917 1325.44 100.674C1326.52 104.757 1328.18 108.404 1330.43 111.595C1332.67 114.787 1335.52 117.336 1338.97 119.242C1342.44 121.17 1346.51 122.123 1351.24 122.123C1355.98 122.123 1360.28 121.107 1363.81 119.056C1367.35 117.004 1370.21 114.331 1372.44 111.015C1374.68 107.699 1376.34 103.969 1377.42 99.8038C1378.5 95.6592 1379.04 91.4109 1379.04 87.0797C1379.04 76.0963 1376.59 67.5583 1371.67 61.4449C1366.74 55.3107 1360.05 52.2437 1351.62 52.2437C1346.49 52.2437 1342.19 53.3006 1338.67 55.4143C1335.14 57.5281 1332.28 60.2636 1330.05 63.6415C1327.81 67.0402 1326.21 70.8533 1325.25 75.1223C1324.3 79.3913 1323.82 83.7639 1323.82 88.2195V88.2402Z"
              fill="white"
            />
          </g>
          <defs>
            <clipPath id="clip0_935_25">
              <rect width="1400.17" height="175.879" fill="white" />
            </clipPath>
          </defs>
        </svg>
      </div>

      {/* Overlay */}
      <div className="loading-overlay absolute inset-0 bg-transparent">&nbsp;</div>

      {/* Images */}
      <div className="loading-images absolute inset-0">
        {images.map((image, index) => (
          <Image
            key={index}
            src={image.src}
            width={image.width}
            height={image.height}
            alt={image.alt}
            className={`absolute inset-0 w-full h-full object-cover transition-opacity duration-300 ${
              index === activeImageIndex ? 'opacity-100' : 'opacity-0'
            }`}
            priority={index === 3} // Only prioritize the initially active image (4th image)
            unoptimized={false} // Allow Next.js optimization
          />
        ))}
      </div>

      {/* Percentage */}
      <div className="loadin-percentage absolute bottom-8 left-1/2 transform -translate-x-1/2 text-white text-xl font-medium">
        {currentValue}%
      </div>
    </div>
  );
};

export default LoadingAnimation;

